// Vulnerability Scanner for Clarity Contracts
class VulnerabilityScanner {
  constructor() {
    this.vulnerabilities = [];
  }

  scanContract(contractCode) {
    this.vulnerabilities = [];
    this.checkReentrancy(contractCode);
    this.checkIntegerOverflow(contractCode);
    this.checkAccessControl(contractCode);
    this.checkInputValidation(contractCode);
    return this.vulnerabilities;
  }

  checkReentrancy(code) {
    if (code.includes('stx-transfer?') && !code.includes('as-contract')) {
      this.addVulnerability('REENTRANCY', 'Potential reentrancy in STX transfer', 'HIGH');
    }
  }

  checkIntegerOverflow(code) {
    if (code.includes('(+') && !code.includes('asserts!')) {
      this.addVulnerability('OVERFLOW', 'Unchecked arithmetic operation', 'MEDIUM');
    }
  }

  checkAccessControl(code) {
    if (code.includes('define-public') && !code.includes('tx-sender')) {
      this.addVulnerability('ACCESS', 'Missing access control', 'HIGH');
    }
  }

  checkInputValidation(code) {
    if (code.includes('define-public') && !code.includes('asserts!')) {
      this.addVulnerability('INPUT', 'Missing input validation', 'MEDIUM');
    }
  }

  addVulnerability(type, description, severity) {
    this.vulnerabilities.push({ type, description, severity, timestamp: Date.now() });
  }
}

module.exports = { VulnerabilityScanner };